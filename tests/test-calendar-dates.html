<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—¥å†æ—¥æœŸæµ‹è¯•</title>
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; 
            padding: 20px; 
            line-height: 1.6;
        }
        .test-grid { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 20px; 
            margin: 20px 0; 
        }
        .test-section { 
            border: 1px solid #ddd; 
            padding: 15px; 
            border-radius: 8px;
            background: #f9f9f9;
        }
        .result { 
            margin: 8px 0; 
            padding: 8px; 
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
        }
        .success { background: #e8f5e8; border-left: 4px solid #4caf50; }
        .error { background: #ffeaea; border-left: 4px solid #f44336; }
        .warning { background: #fff3cd; border-left: 4px solid #ffc107; }
        .info { background: #e7f3ff; border-left: 4px solid #2196f3; }
        
        .calendar-demo {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 2px;
            margin: 10px 0;
            max-width: 350px;
        }
        .calendar-cell {
            aspect-ratio: 1;
            border: 1px solid #ddd;
            display: flex;
            align-items: center;
            justify-content: center;
            background: white;
            font-size: 12px;
        }
        .calendar-cell.has-task {
            background: #e3f2fd;
            font-weight: bold;
        }
        .calendar-header {
            font-weight: bold;
            background: #2196f3;
            color: white;
        }
        
        button {
            background: #2196f3;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #1976d2; }
        
        input, select {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin: 5px;
        }
    </style>
</head>
<body>
    <h1>ğŸ“… æ—¥å†æ—¥æœŸåç§»è¯Šæ–­å·¥å…·</h1>
    
    <div class="test-section">
        <h2>å¿«é€Ÿæµ‹è¯•</h2>
        <p>è¾“å…¥ä¸€ä¸ªä»»åŠ¡æˆªæ­¢æ—¥æœŸï¼Œçœ‹çœ‹å®ƒä¼šæ˜¾ç¤ºåœ¨æ—¥å†çš„å“ªä¸€å¤©ï¼š</p>
        <input type="date" id="testTaskDate" value="2024-06-07">
        <button onclick="runQuickTest()">æµ‹è¯•æ—¥æœŸä½ç½®</button>
        <div id="quickTestResult"></div>
    </div>

    <div class="test-grid">
        <div class="test-section">
            <h3>1. ç³»ç»Ÿæ—¶åŒºä¿¡æ¯</h3>
            <button onclick="testSystemTimezone()">æ£€æŸ¥æ—¶åŒº</button>
            <div id="timezoneResults"></div>
        </div>

        <div class="test-section">
            <h3>2. æ—¥æœŸå­—ç¬¦ä¸²è§£æ</h3>
            <button onclick="testDateParsing()">æµ‹è¯•æ—¥æœŸè§£æ</button>
            <div id="parsingResults"></div>
        </div>

        <div class="test-section">
            <h3>3. æ—¥æœŸæ¯”è¾ƒé€»è¾‘</h3>
            <button onclick="testDateComparison()">æµ‹è¯•æ¯”è¾ƒé€»è¾‘</button>
            <div id="comparisonResults"></div>
        </div>

        <div class="test-section">
            <h3>4. æ—¥å†ç½‘æ ¼ç”Ÿæˆ</h3>
            <select id="testMonth">
                <option value="0">1æœˆ</option>
                <option value="1">2æœˆ</option>
                <option value="2">3æœˆ</option>
                <option value="3">4æœˆ</option>
                <option value="4">5æœˆ</option>
                <option value="5" selected>6æœˆ</option>
                <option value="6">7æœˆ</option>
                <option value="7">8æœˆ</option>
                <option value="8">9æœˆ</option>
                <option value="9">10æœˆ</option>
                <option value="10">11æœˆ</option>
                <option value="11">12æœˆ</option>
            </select>
            <input type="number" id="testYear" value="2024" min="2020" max="2030">
            <button onclick="generateCalendarTest()">ç”Ÿæˆæ—¥å†æµ‹è¯•</button>
            <div id="calendarResults"></div>
        </div>
    </div>

    <div class="test-section">
        <h3>5. æ¨¡æ‹Ÿæ—¥å†æ˜¾ç¤º</h3>
        <p>è¿™é‡Œæ˜¾ç¤ºä¸€ä¸ªç®€åŒ–çš„æ—¥å†ï¼Œè“è‰²è¡¨ç¤ºæœ‰ä»»åŠ¡çš„æ—¥æœŸï¼š</p>
        <div id="calendarDemo"></div>
    </div>

    <script>
        function addResult(containerId, text, type = 'info') {
            const container = document.getElementById(containerId);
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.textContent = text;
            container.appendChild(div);
        }

        function clearResults(containerId) {
            document.getElementById(containerId).innerHTML = '';
        }

        function runQuickTest() {
            clearResults('quickTestResult');
            
            const inputDate = document.getElementById('testTaskDate').value;
            if (!inputDate) {
                addResult('quickTestResult', 'è¯·é€‰æ‹©ä¸€ä¸ªæ—¥æœŸ', 'error');
                return;
            }

            addResult('quickTestResult', `æµ‹è¯•æ—¥æœŸ: ${inputDate}`, 'info');

            // æ¨¡æ‹Ÿä»»åŠ¡åˆ›å»º
            const taskDate = new Date(inputDate);
            taskDate.setHours(0, 0, 0, 0);
            addResult('quickTestResult', `ä»»åŠ¡æ—¥æœŸå¯¹è±¡: ${taskDate.toString()}`, 'info');
            addResult('quickTestResult', `æœ¬åœ°è¡¨ç¤º: ${taskDate.toLocaleDateString('zh-CN')}`, 'info');

            // æ¨¡æ‹Ÿæ—¥å†ä¸­çš„æ—¥æœŸåŒ¹é…
            const year = taskDate.getFullYear();
            const month = taskDate.getMonth();
            const date = taskDate.getDate();

            addResult('quickTestResult', `å¹´: ${year}, æœˆ: ${month + 1}, æ—¥: ${date}`, 'info');

            // åˆ›å»ºæ—¥å†ä¸­å¯¹åº”çš„æ—¥æœŸ
            const calendarDate = new Date(year, month, date);
            addResult('quickTestResult', `æ—¥å†æ—¥æœŸ: ${calendarDate.toString()}`, 'info');
            addResult('quickTestResult', `æ—¥å†æœ¬åœ°è¡¨ç¤º: ${calendarDate.toLocaleDateString('zh-CN')}`, 'info');

            // æ£€æŸ¥æ˜¯å¦åŒ¹é…
            const matches = taskDate.getTime() === calendarDate.getTime();
            addResult('quickTestResult', `æ—¥æœŸåŒ¹é…: ${matches ? 'âœ… æ˜¯' : 'âŒ å¦'}`, matches ? 'success' : 'error');

            if (!matches) {
                const diff = taskDate.getTime() - calendarDate.getTime();
                const diffHours = diff / (1000 * 60 * 60);
                addResult('quickTestResult', `æ—¶é—´å·®: ${diff}ms (${diffHours}å°æ—¶)`, 'warning');
            }
        }

        function testSystemTimezone() {
            clearResults('timezoneResults');
            
            const now = new Date();
            addResult('timezoneResults', `å½“å‰æ—¶é—´: ${now.toString()}`);
            addResult('timezoneResults', `æ—¶åŒºåç§»: ${now.getTimezoneOffset()}åˆ†é’Ÿ`);
            addResult('timezoneResults', `æœ¬åœ°æ—¶åŒº: ${Intl.DateTimeFormat().resolvedOptions().timeZone}`);
            
            // æµ‹è¯•å…³é”®æ—¥æœŸ
            const testDate = new Date('2024-06-07');
            addResult('timezoneResults', `å­—ç¬¦ä¸²æ—¥æœŸ'2024-06-07': ${testDate.toString()}`);
            
            const utcDate = new Date('2024-06-07T00:00:00Z');
            addResult('timezoneResults', `UTCæ—¥æœŸ: ${utcDate.toString()}`);
            
            const localDate = new Date('2024-06-07T00:00:00');
            addResult('timezoneResults', `æœ¬åœ°æ—¥æœŸ: ${localDate.toString()}`);
        }

        function testDateParsing() {
            clearResults('parsingResults');
            
            const testFormats = [
                '2024-06-07',
                '2024-06-07T00:00:00',
                '2024-06-07T12:00:00Z',
                'June 7, 2024',
                '6/7/2024'
            ];

            testFormats.forEach(format => {
                try {
                    const parsed = new Date(format);
                    const normalized = new Date(parsed);
                    normalized.setHours(0, 0, 0, 0);
                    
                    addResult('parsingResults', 
                        `${format} â†’ ${parsed.toLocaleDateString('zh-CN')} â†’ ${normalized.toLocaleDateString('zh-CN')}`);
                } catch (e) {
                    addResult('parsingResults', `${format} â†’ é”™è¯¯: ${e.message}`, 'error');
                }
            });
        }

        function testDateComparison() {
            clearResults('comparisonResults');
            
            // åˆ›å»ºæµ‹è¯•æ—¥æœŸ
            const date1 = new Date('2024-06-07');
            const date2 = new Date(2024, 5, 7); // æœˆä»½ä»0å¼€å§‹
            const date3 = new Date('2024-06-07T12:00:00');

            addResult('comparisonResults', `å­—ç¬¦ä¸²åˆ›å»º: ${date1.toLocaleDateString('zh-CN')}`);
            addResult('comparisonResults', `æ„é€ å‡½æ•°åˆ›å»º: ${date2.toLocaleDateString('zh-CN')}`);
            addResult('comparisonResults', `å¸¦æ—¶é—´åˆ›å»º: ${date3.toLocaleDateString('zh-CN')}`);

            // æ ‡å‡†åŒ–æ¯”è¾ƒ
            const norm1 = new Date(date1);
            const norm2 = new Date(date2);
            const norm3 = new Date(date3);

            norm1.setHours(0, 0, 0, 0);
            norm2.setHours(0, 0, 0, 0);
            norm3.setHours(0, 0, 0, 0);

            const match12 = norm1.getTime() === norm2.getTime();
            const match13 = norm1.getTime() === norm3.getTime();

            addResult('comparisonResults', `å­—ç¬¦ä¸² vs æ„é€ å‡½æ•°: ${match12 ? 'âœ…' : 'âŒ'}`, match12 ? 'success' : 'error');
            addResult('comparisonResults', `å­—ç¬¦ä¸² vs å¸¦æ—¶é—´: ${match13 ? 'âœ…' : 'âŒ'}`, match13 ? 'success' : 'error');
        }

        function generateCalendarTest() {
            clearResults('calendarResults');
            
            const year = parseInt(document.getElementById('testYear').value);
            const month = parseInt(document.getElementById('testMonth').value);

            addResult('calendarResults', `ç”Ÿæˆ ${year}å¹´${month + 1}æœˆ çš„æ—¥å†`);

            // æ¨¡æ‹Ÿæ—¥å†ç”Ÿæˆé€»è¾‘
            const firstDay = new Date(year, month, 1);
            const startDay = new Date(year, month, 1 - firstDay.getDay());

            addResult('calendarResults', `æœˆä»½ç¬¬ä¸€å¤©: ${firstDay.toString()}`);
            addResult('calendarResults', `æ—¥å†èµ·å§‹: ${startDay.toString()}`);

            // ç”Ÿæˆå‰7å¤©ä½œä¸ºç¤ºä¾‹
            for (let i = 0; i < 7; i++) {
                const targetDate = new Date(startDay);
                targetDate.setDate(startDay.getDate() + i);
                
                const cellDate = new Date(targetDate.getFullYear(), targetDate.getMonth(), targetDate.getDate());
                
                const isCurrentMonth = cellDate.getMonth() === month;
                addResult('calendarResults', 
                    `ç¬¬${i + 1}å¤©: ${cellDate.getDate()}æ—¥ (${isCurrentMonth ? 'æœ¬æœˆ' : 'å…¶ä»–æœˆ'})`,
                    isCurrentMonth ? 'success' : 'warning');
            }
        }

        function generateCalendarDemo() {
            const container = document.getElementById('calendarDemo');
            container.innerHTML = '';

            // åˆ›å»ºæ—¥å†æ¼”ç¤º
            const calendarGrid = document.createElement('div');
            calendarGrid.className = 'calendar-demo';

            // æ˜ŸæœŸæ ‡é¢˜
            const weekdays = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];
            weekdays.forEach(day => {
                const header = document.createElement('div');
                header.className = 'calendar-cell calendar-header';
                header.textContent = day;
                calendarGrid.appendChild(header);
            });

            // ç”Ÿæˆ6æœˆçš„æ—¥å†
            const year = 2024;
            const month = 5; // 6æœˆ (ä»0å¼€å§‹)
            const firstDay = new Date(year, month, 1);
            const startDay = new Date(year, month, 1 - firstDay.getDay());

            // æ¨¡æ‹Ÿä»»åŠ¡æ—¥æœŸ
            const taskDates = [new Date(2024, 5, 7), new Date(2024, 5, 14), new Date(2024, 5, 21)];

            for (let i = 0; i < 42; i++) {
                const targetDate = new Date(startDay);
                targetDate.setDate(startDay.getDate() + i);
                
                const cellDate = new Date(targetDate.getFullYear(), targetDate.getMonth(), targetDate.getDate());
                
                const cell = document.createElement('div');
                cell.className = 'calendar-cell';
                if (cellDate.getMonth() !== month) {
                    cell.style.opacity = '0.3';
                }

                // æ£€æŸ¥æ˜¯å¦æœ‰ä»»åŠ¡
                const hasTask = taskDates.some(taskDate => {
                    const normalizedTask = new Date(taskDate);
                    normalizedTask.setHours(0, 0, 0, 0);
                    const normalizedCell = new Date(cellDate);
                    normalizedCell.setHours(0, 0, 0, 0);
                    return normalizedTask.getTime() === normalizedCell.getTime();
                });

                if (hasTask) {
                    cell.classList.add('has-task');
                }

                cell.textContent = cellDate.getDate();
                cell.title = `${cellDate.toLocaleDateString('zh-CN')} ${hasTask ? '(æœ‰ä»»åŠ¡)' : ''}`;
                
                calendarGrid.appendChild(cell);
            }

            container.appendChild(calendarGrid);

            // æ·»åŠ è¯´æ˜
            const info = document.createElement('div');
            info.className = 'result info';
            info.innerHTML = 'è“è‰²æ—¥æœŸè¡¨ç¤ºæœ‰ä»»åŠ¡ã€‚å¦‚æœ6æœˆ7æ—¥ã€14æ—¥ã€21æ—¥ä¸æ˜¯è“è‰²ï¼Œè¯´æ˜æ—¥æœŸåŒ¹é…æœ‰é—®é¢˜ã€‚';
            container.appendChild(info);
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡Œä¸€äº›æµ‹è¯•
        window.onload = function() {
            testSystemTimezone();
            generateCalendarDemo();
        };
    </script>
</body>
</html> 